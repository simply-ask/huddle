{% extends 'dashboard/base.html' %}

{% block title %}Create Meeting - huddle{% endblock %}

{% block extra_css %}
<style>
    /* Enhanced form styles for date/time inputs */
    input[type="date"],
    select {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(255, 255, 255, 0.03);
        color: #fff;
        font-size: 15px;
        font-family: inherit;
        border-radius: 8px;
        transition: all 0.2s;
        cursor: pointer;
    }
    
    input[type="date"]:hover,
    select:hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(255, 255, 255, 0.2);
    }
    
    input[type="date"]:focus,
    select:focus {
        outline: none;
        border-color: #64a93f;
        background: rgba(255, 255, 255, 0.05);
    }
    
    /* Style the calendar and time picker icons */
    input[type="date"]::-webkit-calendar-picker-indicator,
    input[type="time"]::-webkit-calendar-picker-indicator {
        filter: invert(0.8);
        cursor: pointer;
        opacity: 0;
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        width: 100%;
        height: 100%;
    }
    
    /* Make entire input clickable */
    input[type="date"],
    input[type="time"] {
        position: relative;
    }
    
    /* Custom time select dropdown */
    .time-select {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(255, 255, 255, 0.03);
        color: #fff;
        font-size: 15px;
        font-family: inherit;
        border-radius: 8px;
        transition: all 0.2s;
        cursor: pointer;
    }
    
    .time-select:hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(255, 255, 255, 0.2);
    }
    
    .time-select:focus {
        outline: none;
        border-color: #64a93f;
        background: rgba(255, 255, 255, 0.05);
    }
</style>
{% endblock %}

{% block dashboard_content %}

<div style="max-width: 600px;">
    <!-- Simple header -->
    <div class="mb-40">
        <h1 style="font-size: 24px; font-weight: 500; margin-bottom: 8px;">Create Meeting</h1>
        <p class="text-muted">Set up a new meeting session</p>
    </div>

    <!-- Simple form -->
    <form method="post" class="card">
        {% csrf_token %}
        
        <div class="form-group">
            <label for="title">Meeting Title</label>
            <input type="text" id="title" name="title" 
                   placeholder="Weekly standup" 
                   value="{{ title|default:'' }}" required>
        </div>
        
        <!-- Date and Time -->
        <div class="form-group">
            <label for="scheduled_date">Date</label>
            <input type="date" id="scheduled_date" name="scheduled_date" 
                   value="{{ scheduled_date|default:'' }}" required>
        </div>
        
        <div class="form-group">
            <label for="scheduled_time">Time</label>
            <div style="display: flex; gap: 8px; align-items: center;">
                <select id="scheduled_hour" name="scheduled_hour" class="time-select" style="width: 100px;" required>
                    <option value="">Hour</option>
                </select>
                <span style="font-size: 20px; color: rgba(255, 255, 255, 0.5);">:</span>
                <select id="scheduled_minute" name="scheduled_minute" class="time-select" style="width: 100px;" required>
                    <option value="">Min</option>
                    <option value="00">00</option>
                    <option value="15">15</option>
                    <option value="30">30</option>
                    <option value="45">45</option>
                </select>
                <span id="time_display" class="text-muted" style="margin-left: 16px; font-size: 14px;"></span>
            </div>
            <!-- Hidden input to maintain backward compatibility -->
            <input type="hidden" id="scheduled_time" name="scheduled_time">
        </div>
        
        <!-- Location -->
        <div class="form-group">
            <label for="location">Location <span class="text-muted text-small">(Optional)</span></label>
            <input type="text" id="location" name="location" 
                   placeholder="e.g., Conference Room B, 3rd Floor" 
                   value="{{ location|default:'' }}">
        </div>
        
        <div class="form-group">
            <label for="attendees">Attendees</label>
            <textarea id="attendees" name="attendees" 
                      placeholder="john@company.com&#10;jane@company.com" 
                      rows="4">{{ attendees|default:'' }}</textarea>
            <div class="text-muted text-small" style="margin-top: 4px;">
                <i class="fas fa-info-circle"></i>
                Enter email addresses, one per line
            </div>
        </div>
        
        <div class="form-group">
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                <input type="checkbox" name="send_invites" {% if not attendees %}checked{% endif %}>
                Send invitations now
            </label>
        </div>
        
        <div class="flex gap-10">
            <button type="submit" class="btn">
                <i class="fas fa-plus"></i>
                Create Meeting
            </button>
            <a href="{% url 'dashboard' %}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i>
                Back
            </a>
        </div>
    </form>
    
    <!-- Quick add from existing attendees -->
    {% if suggested_speakers %}
    <div class="card">
        <div class="flex-between mb-20">
            <h3 style="font-size: 18px; font-weight: 500;">Quick Add</h3>
            <div class="text-muted text-small">Previous attendees</div>
        </div>
        
        <div style="display: flex; flex-wrap: gap: 8px;">
            {% for speaker in suggested_speakers %}
            <button type="button" class="btn btn-small btn-secondary" 
                    onclick="addSpeaker('{{ speaker.email }}', '{{ speaker.full_name }}')"
                    style="font-size: 13px;">
                <i class="fas fa-plus"></i>
                {{ speaker.full_name }}
            </button>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <!-- Simple help -->
    <div class="card">
        <div class="flex gap-20">
            <div>
                <div class="flex gap-10 mb-10">
                    <i class="fas fa-envelope"></i>
                    <span style="font-weight: 500;">Email Setup</span>
                </div>
                <div class="text-muted text-small">Attendees get voice setup links</div>
            </div>
            
            <div>
                <div class="flex gap-10 mb-10">
                    <i class="fas fa-microphone"></i>
                    <span style="font-weight: 500;">Voice Samples</span>
                </div>
                <div class="text-muted text-small">10-15 seconds for ID</div>
            </div>
            
            <div>
                <div class="flex gap-10 mb-10">
                    <i class="fas fa-phone"></i>
                    <span style="font-weight: 500;">Recording</span>
                </div>
                <div class="text-muted text-small">Single device captures all</div>
            </div>
        </div>
    </div>
</div>

<script>
// Generate time options in 15-minute increments
function generateTimeOptions() {
    const timeSelect = document.getElementById('scheduled_time');
    const savedValue = '{{ scheduled_time|default:"" }}';
    
    for (let hour = 0; hour < 24; hour++) {
        for (let minute = 0; minute < 60; minute += 15) {
            const hourStr = String(hour).padStart(2, '0');
            const minuteStr = String(minute).padStart(2, '0');
            const timeValue = `${hourStr}:${minuteStr}`;
            
            // Format display with AM/PM
            let displayHour = hour;
            let period = 'AM';
            if (hour === 0) {
                displayHour = 12;
            } else if (hour === 12) {
                period = 'PM';
            } else if (hour > 12) {
                displayHour = hour - 12;
                period = 'PM';
            }
            
            const displayTime = `${displayHour}:${minuteStr} ${period}`;
            
            const option = document.createElement('option');
            option.value = timeValue;
            option.textContent = displayTime;
            
            // Set selected if matches saved value
            if (timeValue === savedValue) {
                option.selected = true;
            }
            
            timeSelect.appendChild(option);
        }
    }
    
    // If no saved value, set default to next hour
    if (!savedValue && !timeSelect.value) {
        const now = new Date();
        const nextHour = new Date(now);
        nextHour.setHours(now.getHours() + 1);
        nextHour.setMinutes(Math.ceil(now.getMinutes() / 15) * 15);
        if (nextHour.getMinutes() === 60) {
            nextHour.setHours(nextHour.getHours() + 1);
            nextHour.setMinutes(0);
        }
        
        const defaultTime = `${String(nextHour.getHours()).padStart(2, '0')}:${String(nextHour.getMinutes()).padStart(2, '0')}`;
        timeSelect.value = defaultTime;
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    generateTimeOptions();
    
    // Set default date to today
    const dateInput = document.getElementById('scheduled_date');
    if (!dateInput.value) {
        const today = new Date().toISOString().split('T')[0];
        dateInput.value = today;
    }
});

function addSpeaker(email, name) {
    const attendeesField = document.getElementById('attendees');
    const currentValue = attendeesField.value.trim();
    
    // Check if email already exists
    if (currentValue.includes(email)) {
        return;
    }
    
    // Add the email
    const newValue = currentValue ? currentValue + '\n' + email : email;
    attendeesField.value = newValue;
    
    // Visual feedback
    const button = event.target.closest('button');
    const originalText = button.innerHTML;
    button.innerHTML = '<i class="fas fa-check"></i> Added';
    button.style.background = '#e8f5e8';
    button.style.color = '#2e7d32';
    
    setTimeout(() => {
        button.innerHTML = originalText;
        button.style.background = '';
        button.style.color = '';
    }, 1500);
}
</script>

{% endblock %}