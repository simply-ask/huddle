{% extends 'dashboard/base.html' %}

{% block title %}Create Meeting - huddle{% endblock %}

{% block dashboard_content %}

<div style="max-width: 600px;">
    <!-- Simple header -->
    <div class="mb-40">
        <h1 style="font-size: 24px; font-weight: 500; margin-bottom: 8px;">Create Meeting</h1>
        <p class="text-muted">Set up a new meeting session</p>
    </div>

    <!-- Simple form -->
    <form method="post" class="card">
        {% csrf_token %}
        
        <div class="form-group">
            <label for="title">Meeting Title</label>
            <input type="text" id="title" name="title" 
                   placeholder="Weekly standup" 
                   value="{{ title|default:'' }}" required>
        </div>
        
        <!-- Date and Time -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
            <div class="form-group">
                <label for="scheduled_date">Date</label>
                <input type="date" id="scheduled_date" name="scheduled_date" 
                       value="{{ scheduled_date|default:'' }}" required>
            </div>
            
            <div class="form-group">
                <label for="scheduled_time">Time</label>
                <input type="time" id="scheduled_time" name="scheduled_time" 
                       value="{{ scheduled_time|default:'' }}" required>
            </div>
        </div>
        
        
        <!-- Meeting Type -->
        <div class="form-group">
            <label for="meeting_type">Meeting Type</label>
            <select id="meeting_type" name="meeting_type" onchange="toggleLocationFields()">
                <option value="virtual" {% if meeting_type == 'virtual' %}selected{% endif %}>Virtual</option>
                <option value="in_person" {% if meeting_type == 'in_person' %}selected{% endif %}>In Person</option>
                <option value="hybrid" {% if meeting_type == 'hybrid' %}selected{% endif %}>Hybrid</option>
            </select>
        </div>
        
        <!-- Location (for in-person/hybrid) -->
        <div class="form-group" id="location_field" style="display: none;">
            <label for="location">Location</label>
            <input type="text" id="location" name="location" 
                   placeholder="Conference Room B, 3rd Floor" 
                   value="{{ location|default:'' }}">
        </div>
        
        <!-- Meeting Link (for virtual/hybrid) -->
        <div class="form-group" id="meeting_link_field">
            <label for="meeting_link">Meeting Link (optional)</label>
            <input type="url" id="meeting_link" name="meeting_link" 
                   placeholder="https://zoom.us/j/123456789" 
                   value="{{ meeting_link|default:'' }}">
            <div class="text-muted text-small" style="margin-top: 4px;">
                <i class="fas fa-info-circle"></i>
                Leave blank to use huddle's built-in meeting room
            </div>
        </div>
        
        <div class="form-group">
            <label for="attendees">Attendees</label>
            <textarea id="attendees" name="attendees" 
                      placeholder="john@company.com&#10;jane@company.com" 
                      rows="4">{{ attendees|default:'' }}</textarea>
            <div class="text-muted text-small" style="margin-top: 4px;">
                <i class="fas fa-info-circle"></i>
                Enter email addresses, one per line
            </div>
        </div>
        
        <div class="form-group">
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                <input type="checkbox" name="send_invites" {% if not attendees %}checked{% endif %}>
                Send invitations now
            </label>
        </div>
        
        <div class="flex gap-10">
            <button type="submit" class="btn">
                <i class="fas fa-plus"></i>
                Create Meeting
            </button>
            <a href="{% url 'dashboard' %}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i>
                Back
            </a>
        </div>
    </form>
    
    <!-- Quick add from existing speakers -->
    {% if suggested_speakers %}
    <div class="card">
        <div class="flex-between mb-20">
            <h3 style="font-size: 18px; font-weight: 500;">Quick Add</h3>
            <div class="text-muted text-small">Existing speakers</div>
        </div>
        
        <div style="display: flex; flex-wrap: gap: 8px;">
            {% for speaker in suggested_speakers %}
            <button type="button" class="btn btn-small btn-secondary" 
                    onclick="addSpeaker('{{ speaker.email }}', '{{ speaker.full_name }}')"
                    style="font-size: 13px;">
                <i class="fas fa-plus"></i>
                {{ speaker.full_name }}
            </button>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <!-- Simple help -->
    <div class="card">
        <div class="flex gap-20">
            <div>
                <div class="flex gap-10 mb-10">
                    <i class="fas fa-envelope"></i>
                    <span style="font-weight: 500;">Email Setup</span>
                </div>
                <div class="text-muted text-small">Attendees get voice setup links</div>
            </div>
            
            <div>
                <div class="flex gap-10 mb-10">
                    <i class="fas fa-microphone"></i>
                    <span style="font-weight: 500;">Voice Samples</span>
                </div>
                <div class="text-muted text-small">10-15 seconds for ID</div>
            </div>
            
            <div>
                <div class="flex gap-10 mb-10">
                    <i class="fas fa-phone"></i>
                    <span style="font-weight: 500;">Recording</span>
                </div>
                <div class="text-muted text-small">Single device captures all</div>
            </div>
        </div>
    </div>
</div>

<script>
function toggleLocationFields() {
    const meetingType = document.getElementById('meeting_type').value;
    const locationField = document.getElementById('location_field');
    const meetingLinkField = document.getElementById('meeting_link_field');
    const locationInput = document.getElementById('location');
    const meetingLinkInput = document.getElementById('meeting_link');
    
    if (meetingType === 'in_person') {
        locationField.style.display = 'block';
        meetingLinkField.style.display = 'none';
        locationInput.required = true;
        meetingLinkInput.required = false;
    } else if (meetingType === 'virtual') {
        locationField.style.display = 'none';
        meetingLinkField.style.display = 'block';
        locationInput.required = false;
        meetingLinkInput.required = false;
    } else if (meetingType === 'hybrid') {
        locationField.style.display = 'block';
        meetingLinkField.style.display = 'block';
        locationInput.required = true;
        meetingLinkInput.required = false;
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    toggleLocationFields();
    
    // Set default date to today
    const dateInput = document.getElementById('scheduled_date');
    if (!dateInput.value) {
        const today = new Date().toISOString().split('T')[0];
        dateInput.value = today;
    }
    
    // Set default time to next hour
    const timeInput = document.getElementById('scheduled_time');
    if (!timeInput.value) {
        const now = new Date();
        now.setHours(now.getHours() + 1, 0, 0, 0);
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        timeInput.value = `${hours}:${minutes}`;
    }
});

function addSpeaker(email, name) {
    const attendeesField = document.getElementById('attendees');
    const currentValue = attendeesField.value.trim();
    
    // Check if email already exists
    if (currentValue.includes(email)) {
        return;
    }
    
    // Add the email
    const newValue = currentValue ? currentValue + '\n' + email : email;
    attendeesField.value = newValue;
    
    // Visual feedback
    const button = event.target.closest('button');
    const originalText = button.innerHTML;
    button.innerHTML = '<i class="fas fa-check"></i> Added';
    button.style.background = '#e8f5e8';
    button.style.color = '#2e7d32';
    
    setTimeout(() => {
        button.innerHTML = originalText;
        button.style.background = '';
        button.style.color = '';
    }, 1500);
}
</script>

{% endblock %}